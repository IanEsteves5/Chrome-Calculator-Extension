var plot={plotCanvas:document.getElementById("plot"),plotContext:document.getElementById("plot").getContext("2d"),height:500,width:500,xmin:-10,xmax:10,ymin:-10,ymax:10,xstep:0.1,numberOfFunctions:1,functionParseTrees:[],init:function(){this.width=window.innerWidth;this.plotCanvas.width=this.width;this.height=window.innerHeight;this.plotCanvas.height=this.height;this.ymin=-10;this.ymax=10;this.xmin=this.ymin*(this.width/this.height);this.xmax=this.ymax*(this.width/this.height);this.xstep=(this.xmax-this.xmin)*1.1/this.width;this.getParseTrees();this.drawAxes()},getParseTrees:function(){this.functionParseTrees=[];for(var b=0;b<this.numberOfFunctions;b++){var a=getParseTree(getTokens(document.getElementById("plotFunction"+b).value));if(a===null){continue}this.functionParseTrees.push(a)}},zoomIn:function(a){var c=(this.xmax+this.xmin)/2;var b=(this.ymax+this.ymin)/2;this.xmin=(this.xmin-c)/a+c;this.xmax=(this.xmax-c)/a+c;this.ymin=(this.ymin-b)/a+b;this.ymax=(this.ymax-b)/a+b;this.xstep=(this.xmax-this.xmin)*1.1/this.width;this.drawEverything()},zoomOut:function(a){var c=(this.xmax+this.xmin)/2;var b=(this.ymax+this.ymin)/2;this.xmin=(this.xmin-c)*a+c;this.xmax=(this.xmax-c)*a+c;this.ymin=(this.ymin-b)*a+b;this.ymax=(this.ymax-b)*a+b;this.xstep=(this.xmax-this.xmin)*1.1/this.width;this.drawEverything()},drag:function(a,b){this.xmin-=a*(this.xmax-this.xmin)/this.width;this.xmax-=a*(this.xmax-this.xmin)/this.width;this.ymin+=b*(this.ymax-this.ymin)/this.height;this.ymax+=b*(this.ymax-this.ymin)/this.height;this.drawEverything()},resize:function(b,a){var d=(this.xmax+this.xmin)/2;var c=(this.ymax+this.ymin)/2;this.width=b;this.height=a;this.xmin=(this.ymin-c)*(b/a)+d;this.xmax=(this.ymax-c)*(b/a)+d;this.plotCanvas.width=b;this.plotCanvas.height=a;this.drawEverything()},getXPixel:function(a){return this.width*(a-this.xmin)/(this.xmax-this.xmin)},getYPixel:function(a){return this.height*(a-this.ymax)/(this.ymin-this.ymax)},getXCoord:function(a){return this.xmin+a*(this.xmax-this.xmin)/this.width},getYCoord:function(a){return this.ymax+a*(this.ymin-this.ymax)/this.height},moveToCoord:function(a,b){this.plotContext.moveTo(this.getXPixel(a),this.getYPixel(b))},lineToCoord:function(a,b){this.plotContext.lineTo(this.getXPixel(a),this.getYPixel(b))},clear:function(){this.plotCanvas.height=this.plotCanvas.height},drawAxes:function(){var c=Math.round(Math.log((this.ymax-this.ymin)/10)/Math.LN10);var b;if(c>0){b=Math.pow(10,c)}else{b=1}this.plotContext.beginPath();this.plotContext.strokeStyle="#AAAAAA";this.plotContext.fillStyle="#AAAAAA";this.plotContext.font="normal 12px Courier new";this.moveToCoord(0,this.ymin);this.lineToCoord(0,this.ymax);this.moveToCoord(this.xmin,0);this.lineToCoord(this.xmax,0);this.plotContext.textAlign="center";this.plotContext.textBaseline="top";for(var a=Math.ceil(this.xmin/b)*b;a<=this.xmax;a+=b){if(Math.abs(a)<b/10){continue}this.plotContext.moveTo(this.getXPixel(a),this.getYPixel(0)-5);this.plotContext.lineTo(this.getXPixel(a),this.getYPixel(0)+5);this.plotContext.fillText(a,this.getXPixel(a),this.getYPixel(0)+7)}this.plotContext.textAlign="right";this.plotContext.textBaseline="middle";for(var d=Math.ceil(this.ymin/b)*b;d<=this.ymax;d+=b){if(d===0){continue}this.plotContext.moveTo(this.getXPixel(0)-5,this.getYPixel(d));this.plotContext.lineTo(this.getXPixel(0)+5,this.getYPixel(d));this.plotContext.fillText(d,this.getXPixel(0)-7,this.getYPixel(d))}this.plotContext.stroke()},drawFunctions:function(){var a=new memoryEntry("x",this.xmin);memory=[];memory.push(a);var e=[];for(var b=0;b<this.functionParseTrees.length;b++){e.push(this.functionParseTrees[b].val())}this.plotContext.beginPath();this.plotContext.strokeStyle="#000000";while(a.val<this.xmax){var c=a.val;a.val+=this.xstep;for(var b=0;b<this.functionParseTrees.length;b++){errorLog="";var d=this.functionParseTrees[b].val();if(d===null||d===true||d===false||isNaN(d)||((e[b]>this.ymax||e[b]<this.ymin)&&(d>this.ymax||d<this.ymin))){e[b]=d;continue}this.moveToCoord(c,e[b]);this.lineToCoord(a.val,d);e[b]=d}}this.plotContext.stroke()},drawEverything:function(){this.clear();this.drawAxes();this.drawFunctions()}};function updateMousePosDiv(a,b){mousePosDiv.innerHTML=""+Math.floor(plot.getXCoord(event.clientX)*100)/100+", "+Math.floor(plot.getYCoord(event.clientY)*100)/100}var mouseDownFlag=false;var lastMousePos={x:0,y:0};var mousePosDiv=document.getElementById("mousePosition");window.onload=function(){plot.init();document.getElementById("plotControls").onkeyup=function(a){if(a.keyCode!==13){return}plot.getParseTrees();plot.drawEverything()};document.getElementById("addFunction").onmousedown=function(b){if(plot.numberOfFunctions>=5){return}var a=document.createElement("input");document.getElementById("plotFunctions").appendChild(document.createElement("br"));document.getElementById("plotFunctions").appendChild(a);a.id="plotFunction"+plot.numberOfFunctions;a.classList.add("plotFunctionInput");plot.numberOfFunctions++};document.getElementById("removeFunction").onmousedown=function(a){if(plot.numberOfFunctions<=1){return}document.getElementById("plotFunctions").removeChild(document.getElementById("plotFunctions").lastChild);document.getElementById("plotFunctions").removeChild(document.getElementById("plotFunctions").lastChild);plot.numberOfFunctions--;if(plot.numberOfFunctions<plot.functionParseTrees.length){plot.functionParseTrees.pop()}plot.drawEverything()};window.onresize=function(a){plot.resize(window.innerWidth,window.innerHeight)};document.getElementById("plot").onmousedown=function(a){updateMousePosDiv(a.clientX,a.clientY);mouseDownFlag=true;lastMousePos={x:a.clientX,y:a.clientY}};document.getElementById("plot").onmouseup=function(a){mouseDownFlag=false};document.getElementById("plot").onmouseout=function(a){mouseDownFlag=false};document.getElementById("plot").onmousemove=function(a){if(!mouseDownFlag){return}plot.drag(a.clientX-lastMousePos.x,a.clientY-lastMousePos.y);lastMousePos={x:a.clientX,y:a.clientY}};document.getElementById("plot").onmousewheel=function(a){if(a.deltaY>0){plot.zoomOut(1.2)}if(a.deltaY<0){plot.zoomIn(1.2)}}};